<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Reezo Moderator Settings</title>
  <style>
    :root {
      --bg: #120d0e;
      --card: #201416;
      --border: #5f353a;
      --text: #f5e8ea;
      --muted: #d8bfc4;
      --accent: #f59e0b;
      --accent2: #f97316;
      --danger: #dc2626;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      background: radial-gradient(circle at 20% 0%, #2b1a1d, var(--bg) 55%);
      color: var(--text);
      font-family: "Segoe UI", Tahoma, sans-serif;
    }
    .page { max-width: 820px; margin: 0 auto; padding: 16px; }
    .card {
      background: rgba(32, 20, 22, 0.92);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px;
      margin-top: 12px;
    }
    h1 { margin: 0; font-size: 20px; }
    p { margin: 6px 0 0; color: var(--muted); font-size: 13px; line-height: 1.45; }
    .tabs {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 8px;
      margin-top: 12px;
    }
    .tab-btn {
      border: 1px solid #8d4d54;
      border-radius: 12px;
      background: rgba(56, 24, 29, 0.86);
      color: #f4e2e6;
      padding: 10px;
      font-weight: 700;
      cursor: pointer;
    }
    .tab-btn.active {
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color: #2e1400;
      border-color: var(--accent);
    }
    .panel { display: none; margin-top: 12px; }
    .panel.active { display: block; }
    .label { display: block; font-size: 13px; margin: 0 0 6px; color: var(--text); font-weight: 700; }
    textarea, input, select {
      width: 100%;
      border: 1px solid #8d4d54;
      border-radius: 10px;
      background: rgba(43, 18, 22, 0.92);
      color: #fff2f5;
      padding: 10px;
      font-size: 14px;
      outline: none;
    }
    .row { display: grid; gap: 10px; margin-top: 10px; }
    .row-2 { grid-template-columns: 1fr 1fr; }
    .toggle {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-top: 8px;
      font-size: 13px;
      color: var(--muted);
    }
    .btns {
      display: flex;
      gap: 8px;
      flex-wrap: wrap;
      margin-top: 14px;
    }
    button.action {
      border: 1px solid var(--accent);
      border-radius: 10px;
      background: linear-gradient(90deg, var(--accent) 0%, var(--accent2) 100%);
      color: #2e1400;
      font-weight: 800;
      padding: 10px 14px;
      cursor: pointer;
    }
    button.secondary {
      border: 1px solid var(--border);
      border-radius: 10px;
      background: rgba(27, 18, 20, 0.92);
      color: var(--text);
      font-weight: 700;
      padding: 10px 14px;
      cursor: pointer;
    }
    .status { margin-top: 10px; font-size: 13px; color: var(--muted); }
    .danger { color: #ffb4b4; }
    @media (max-width: 700px) { .row-2 { grid-template-columns: 1fr; } }
  </style>
</head>
<body>
  <main class="page">
    <h1>Reezo Moderator Settings</h1>
    <p>Set chat target untuk auto-delete dan user list untuk auto-ban.</p>

    <section class="card">
      <div class="tabs">
        <button id="tabChats" class="tab-btn active" type="button">Target Chats</button>
        <button id="tabUsers" class="tab-btn" type="button">Auto-Ban Users</button>
      </div>

      <div id="panelChats" class="panel active">
        <label class="label" for="chatIds">Group IDs (satu baris satu ID, contoh: -1001234567890)</label>
        <textarea id="chatIds" rows="7" placeholder="-1001234567890&#10;-1009876543210"></textarea>

        <div class="row row-2">
          <div>
            <label class="label" for="modeSelect">Action Mode</label>
            <select id="modeSelect">
              <option value="delete_and_ban">Delete + Ban</option>
              <option value="delete_only">Delete Only</option>
              <option value="ban_only">Ban Only</option>
            </select>
          </div>
          <div>
            <label class="label" for="floodThreshold">Flood Threshold (msg/min)</label>
            <input id="floodThreshold" type="number" min="1" value="6" />
          </div>
        </div>

        <label class="toggle"><input id="enableModeration" type="checkbox" checked /> Enable moderation</label>
      </div>

      <div id="panelUsers" class="panel">
        <label class="label" for="userIds">User IDs Auto-Ban (satu baris satu ID)</label>
        <textarea id="userIds" rows="8" placeholder="123456789&#10;987654321"></textarea>
        <p class="danger">Tip: user dalam list ini akan terus di-ban bila mereka hantar mesej di target chat.</p>
      </div>

      <div class="btns">
        <button id="saveBtn" class="action" type="button">Save Settings</button>
        <button id="backBtn" class="secondary" type="button">Back to Bot</button>
      </div>
      <div id="status" class="status">Ready.</div>
    </section>
  </main>

  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    (function () {
      var tg = window.Telegram && window.Telegram.WebApp ? window.Telegram.WebApp : null;
      if (tg) { tg.ready(); tg.expand(); }

      var tabChats = document.getElementById("tabChats");
      var tabUsers = document.getElementById("tabUsers");
      var panelChats = document.getElementById("panelChats");
      var panelUsers = document.getElementById("panelUsers");

      var chatIdsEl = document.getElementById("chatIds");
      var userIdsEl = document.getElementById("userIds");
      var modeEl = document.getElementById("modeSelect");
      var floodEl = document.getElementById("floodThreshold");
      var enabledEl = document.getElementById("enableModeration");
      var saveBtn = document.getElementById("saveBtn");
      var backBtn = document.getElementById("backBtn");
      var statusEl = document.getElementById("status");

      function setTab(which) {
        var chats = which === "chats";
        tabChats.classList.toggle("active", chats);
        tabUsers.classList.toggle("active", !chats);
        panelChats.classList.toggle("active", chats);
        panelUsers.classList.toggle("active", !chats);
      }

      function cleanLines(raw, mustNegative) {
        return (raw || "")
          .split(/\n+/)
          .map(function (x) { return x.trim(); })
          .filter(Boolean)
          .map(function (x) { return x.replace(/[,\s]/g, ""); })
          .filter(function (x) {
            if (!/^-?\d+$/.test(x)) return false;
            if (mustNegative) return x.startsWith("-");
            return true;
          })
          .map(function (x) { return Number(x); });
      }

      function saveSettings() {
        var chatIds = cleanLines(chatIdsEl.value, true);
        var autoBanUserIds = cleanLines(userIdsEl.value, false);
        var floodThreshold = Number(floodEl.value || 6);

        if (!chatIds.length) {
          statusEl.textContent = "At least 1 target chat ID required.";
          return;
        }
        if (!Number.isFinite(floodThreshold) || floodThreshold < 1) {
          statusEl.textContent = "Flood threshold invalid.";
          return;
        }

        var payload = {
          type: "reezo_moderator_settings_save",
          moderation_enabled: !!enabledEl.checked,
          mode: modeEl.value,
          flood_threshold_per_minute: floodThreshold,
          target_chat_ids: chatIds,
          auto_ban_user_ids: autoBanUserIds,
          saved_at: new Date().toISOString()
        };

        if (tg) {
          tg.sendData(JSON.stringify(payload));
          statusEl.textContent = "Settings sent to bot.";
          return;
        }
        statusEl.textContent = "Preview mode: " + JSON.stringify(payload);
      }

      function backToBot() {
        var payload = { type: "reezo_moderator_back_to_menu" };
        if (tg) {
          tg.sendData(JSON.stringify(payload));
          tg.close();
          return;
        }
        statusEl.textContent = "Preview mode: open inside Telegram to go back.";
      }

      tabChats.addEventListener("click", function () { setTab("chats"); });
      tabUsers.addEventListener("click", function () { setTab("users"); });
      saveBtn.addEventListener("click", saveSettings);
      backBtn.addEventListener("click", backToBot);
    })();
  </script>
</body>
</html>
